{% extends 'base.html' %}

{% block content %}

<style>
    .card {
    background-color: var(--card-dark);
    color: var(--text-light);
    border-radius: 12px;
    border: 1px solid var(--primary-color);
    box-shadow: var(--shadow-purple);
    transition: transform 0.3s ease-in-out;
}

.card:hover {
    transform: translateY(-5px); /* Hover effect */
}

.card-title {
    color: var(--primary-color);
    font-weight: 700 !important;
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 8px;
    margin-bottom: 15px;
}

/* Customizing Bootstrap Buttons */
.btn-primary {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    transition: all 0.3s;
}

.btn-primary:hover {
    background-color: #7d26da;
    border-color: #7d26da;
    box-shadow: 0 0 10px var(--primary-color);
}

.btn-success {
    background-color: #00b894; /* Brighter Green for "Start" */
    border-color: #00b894;
}

.btn-success:hover {
    background-color: #00e6a8;
    border-color: #00e6a8;
}

/* Stream and Image Area Styling */
.ratio-16x9 {
    background-color: #000000; /* Pure Black for video feed */
    border: 2px solid var(--primary-color);
    border-radius: 8px !important;
}

/* Last Detection Box */
.last-detection-box {
    background-color: #2c2c2c;
    border: 1px solid #444;
    border-left: 5px solid var(--primary-color); /* Highlight with purple border */
}

/* List Group for Users */
.list-group-item {
    background-color: #252525;
    color: var(--text-light);
    border: 1px solid #333;
    margin-bottom: 5px;
    border-radius: 8px !important;
    transition: background-color 0.2s;
}

.list-group-item:hover {
    background-color: #383838;
}

.form-control {
    background-color: #2c2c2c;
    color: var(--text-light);
    border: 1px solid #444;
}
.form-control:focus {
    background-color: #2c2c2c;
    color: var(--text-light);
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.25rem rgba(106, 13, 173, 0.5);
}


</style>
<!-- HERO SECTION -->
<section class="py-5 px-3"
    style="
        background: radial-gradient(circle at right, #481197, #120022 60%);
        color: white;
    ">
    <div class="container">
        <div class="row align-items-center">

            <!-- Left Text -->
            <div class="col-lg-6 mb-4">
                <h1 class="fw-bold display-5" style="color: whitesmoke; text-align: left;">
                    Unlock the Future<br>
                    with <span style="color:#b56bff;">AI-Powered</span><br>
                    Face Recognition
                </h1>
                <p class="mt-3 text-light opacity-75">
                    Seamless, secure, and lightning-fast face detection for authentication,
                    attendance, and identity verification.
                </p>

                <div class="mt-4">
                    <a href="{{ url_for('register') }}" class="btn px-4 py-2 me-2 hover-btn"
                        style="background:#b300ff; color:white; border-radius:50px">
                        Get Started
                    </a>
                    <a href="{{ url_for('login') }}" class="btn px-4 py-2 hover-btn-2"
                        style="background:#ffffff22; backdrop-filter:blur(8px); color:white; border-radius:50px;">
                        Sign In
                    </a>
                </div>
            </div>

            <!-- Right AI Face Image -->
            <div class="col-lg-6 text-center">
                <img src="{{ url_for('static', filename='images/hero-face.jpg') }}"
                     class="img-fluid"
                     style="max-height:360px; border-radius:20px;
                     box-shadow:0 0 25px #8a2be2;">
            </div>

        </div>
    </div>
</section>

<!-- FEATURE CARDS -->
<section class="py-5" style="background:#0e001d;">
    <div class="container">
        <div class="row g-4">

            {% for item in [
                ('Live Camera Stream', 'fas fa-video'),
                ('Recognize from Image', 'fas fa-image'),
                ('Registered Users', 'fas fa-users'),
                ('Attendance Reports', 'fas fa-file-alt')
            ] %}
            <div class="col-md-6 col-lg-3">
                <div class="p-4 rounded-4 text-center shadow-lg"
                     style="
                       backdrop-filter: blur(20px);
                       background: rgba(255,255,255,0.06);
                       border:1px solid rgba(255,255,255,0.1);
                       color:white;
                     ">
                    <i class="{{ item[1] }} mb-3" style="font-size:2rem; color:#bf71ff;"></i>
                    <h5 class="fw-bold" style="white-space: nowrap;">{{ item[0] }}</h5>
                </div>
            </div>
            {% endfor %}

        </div>
    </div>
</section>


<section class="py-5" style="background: linear-gradient(135deg, #0f0015 0%, #1a0033 50%, #2d0052 100%); min-height:100vh; position:relative; overflow:hidden;">
  <!-- Animated background elements -->
  <div style="position:absolute; top:-100px; right:-100px; width:300px; height:300px; background:radial-gradient(circle, rgba(179,0,255,0.15) 0%, transparent 70%); border-radius:50%; animation:float 6s ease-in-out infinite;"></div>
  <div style="position:absolute; bottom:-50px; left:-50px; width:250px; height:250px; background:radial-gradient(circle, rgba(255,0,110,0.1) 0%, transparent 70%); border-radius:50%; animation:float 8s ease-in-out infinite reverse;"></div>

  <div class="container" style="position:relative; z-index:1;">
    <!-- Header -->
    <div style="text-align:center; margin-bottom:3rem; animation:slideDown 0.8s ease-out;">
      <h2 style="color:#fff; font-weight:900; font-size:2.5rem; margin-bottom:0.5rem; text-shadow:0 0 20px rgba(179,0,255,0.5);">
        <i class="fa-solid fa-id-badge" style="color:#ff006e;"></i> Live Face Recognition
      </h2>
      <p style="color:#b300ff; font-weight:600; font-size:1rem; letter-spacing:1px;">AI-Powered Attendance System</p>
    </div>

    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(500px, 1fr)); gap:2rem; margin-bottom:2rem;">
      
      <!-- LIVE STREAM -->
      <div style="background:rgba(20,20,20,0.8); backdrop-filter:blur(10px); border-radius:20px; overflow:hidden; border:1px solid rgba(179,0,255,0.3); box-shadow:0 8px 32px rgba(179,0,255,0.2); animation:fadeInUp 1s ease-out;">
        <div style="padding:2rem;">
          <h5 style="color:#ff006e; font-weight:700; font-size:1.2rem; margin-bottom:1.5rem;">
            <i class="fa-solid fa-video" style="margin-right:0.75rem;"></i> Live Camera Stream
          </h5>

          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; flex-wrap:wrap; gap:1rem;">
            <span id="streamStatus" style="background:linear-gradient(135deg, #dc3545, #c82333); color:white; padding:0.5rem 1rem; border-radius:50px; font-size:0.85rem; font-weight:600; letter-spacing:0.5px;">OFFLINE</span>

            <div style="display:flex; gap:0.75rem;">
              <button id="startStreams" onclick="startStreamAction()" style="background:linear-gradient(135deg, #00d4ff, #0088ff); color:white; border:none; padding:0.5rem 1rem; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(0,212,255,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,212,255,0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,212,255,0.3)';">
                <i class="fa-solid fa-play"></i>
              </button>

              <button id="stopStreams" onclick="stopStreamAction()" style="background:linear-gradient(135deg, #ff006e, #d60056); color:white; border:none; padding:0.5rem 1rem; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s ease; box-shadow:0 4px 15px rgba(255,0,110,0.3);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255,0,110,0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255,0,110,0.3)';">
                <i class="fa-solid fa-stop"></i>
              </button>
            </div>
          </div>

          <div style="aspect-ratio:16/9; border:2px solid; border-image:linear-gradient(135deg, #00d4ff, #ff006e) 1; border-radius:16px; overflow:hidden; box-shadow:0 0 20px rgba(179,0,255,0.3), inset 0 0 20px rgba(0,212,255,0.1);">
            <img id="cam1" data-src="{{ url_for('video1') }}" style="width:100%; height:100%; object-fit:cover; filter:brightness(0.95) contrast(1.1);"/>
          </div>

          <div style="margin-top:2rem;">
            <small style="color:#aaa; display:block; margin-bottom:0.75rem; font-weight:600; letter-spacing:0.5px;">LAST DETECTED PERSON:</small>
            <div style="background:rgba(179,0,255,0.1); border-left:4px solid #ff006e; padding:1.25rem; border-radius:12px; backdrop-filter:blur(5px);">
              <strong id="lastName" style="color:#00d4ff; font-size:1.1rem;">None</strong>
              <span id="lastReg" style="color:#999; display:block; margin-top:0.5rem; font-size:0.9rem;">N/A</span>
            </div>
          </div>
        </div>
      </div>

      <!-- IMAGE RECOGNITION -->
      <div style="background:rgba(20,20,20,0.8); backdrop-filter:blur(10px); border-radius:20px; overflow:hidden; border:1px solid rgba(179,0,255,0.3); box-shadow:0 8px 32px rgba(179,0,255,0.2); animation:fadeInUp 1s ease-out 0.1s both;">
        <div style="padding:2rem;">
          <h5 style="color:#ff006e; font-weight:700; font-size:1.2rem; margin-bottom:1.5rem;">
            <i class="fa-solid fa-image" style="margin-right:0.75rem;"></i> Recognize From Image
          </h5>

          <form id="uploadForm" enctype="multipart/form-data">
            <div style="display:flex; border-radius:50px; overflow:hidden; margin-bottom:2rem; box-shadow:0 4px 15px rgba(255,0,110,0.2);">
              <label style="background:linear-gradient(135deg, #ff006e, #b300ff); color:white; padding:0 1.25rem; display:flex; align-items:center; cursor:pointer; font-weight:600;">
                <i class="fa-solid fa-upload"></i>
              </label>

              <input type="file" class="form-control" id="imageFile" accept="image/*" required onchange="previewImage()" style="background:#1d1d1d; color:#fff; border:none; padding:0.75rem 1rem; flex:1; outline:none;">

              <button class="btn" onclick="recognizeImage()" type="button" style="background:linear-gradient(135deg, #00d4ff, #0088ff); color:white; border:none; padding:0 1.5rem; cursor:pointer; font-weight:600; transition:all 0.3s ease;" onmouseover="this.style.transform='scale(1.05)';" onmouseout="this.style.transform='scale(1)';">
                <i class="fa-solid fa-brain"></i>
              </button>
            </div>
          </form>

          <div id="imagePreviewContainer" style="display:none; text-align:center; margin-bottom:2rem; animation:fadeIn 0.5s ease-out;">
            <h6 style="color:#aaa; margin-bottom:1rem; font-weight:600; letter-spacing:0.5px;">IMAGE PREVIEW:</h6>
            <img id="imagePreview" style="max-width:300px; max-height:200px; object-fit:cover; border:3px solid #ff006e; border-radius:16px; box-shadow:0 0 20px rgba(255,0,110,0.3);"/>
          </div>

          <div id="uploadResult" style="background:rgba(179,0,255,0.1); border-left:4px solid #00d4ff; padding:1.25rem; border-radius:12px; color:#fff; backdrop-filter:blur(5px);">
            <small style="color:#aaa;">Recognition status will appear here.</small>
          </div>
        </div>
      </div>
    </div>

    <!-- REGISTERED USERS -->
    <div style="background:rgba(20,20,20,0.8); backdrop-filter:blur(10px); border-radius:20px; overflow:hidden; border:1px solid rgba(179,0,255,0.3); box-shadow:0 8px 32px rgba(179,0,255,0.2); animation:fadeInUp 1s ease-out 0.2s both;">
      <div style="padding:2rem;">
        <h5 style="color:#ff006e; font-weight:700; font-size:1.2rem; margin-bottom:1.5rem;">
          <i class="fa-solid fa-users" style="margin-right:0.75rem;"></i>
          Registered Users
          <span style="background:linear-gradient(135deg, #00d4ff, #0088ff); color:white; padding:0.25rem 0.75rem; border-radius:50px; font-size:0.8rem; margin-left:0.5rem;">{{ users|length }}</span>
        </h5>

        <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:1.5rem;">
          {% for u in users %}
          <div style="background:rgba(26,26,26,0.6); border:1px solid rgba(179,0,255,0.3); border-radius:16px; padding:1.25rem; text-align:center; transition:all 0.3s ease; cursor:pointer;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(179,0,255,0.3)'; this.style.borderColor='rgba(255,0,110,0.6)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='rgba(179,0,255,0.3)';">
            <div style="margin-bottom:1rem;">
              {% set thumb = u.regid ~ '.jpg' %}
              {% if uploads and thumb in uploads %}
              <img src="{{ url_for('get_image', filename=thumb) }}" style="width:80px; height:80px; object-fit:cover; border:3px solid #ff006e; border-radius:50%; margin:0 auto; display:block; box-shadow:0 0 15px rgba(255,0,110,0.4);"/>
              {% else %}
              <i class="fa-solid fa-user" style="font-size:60px; color:#00d4ff;"></i>
              {% endif %}
            </div>
            <strong style="color:#00d4ff; font-size:0.95rem; text-transform:uppercase; display:block; margin-bottom:0.5rem;">{{ u.name }}</strong>
            <small style="color:#999; font-weight:600; letter-spacing:0.5px;">{{ u.regid }}</small>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(20px); }
    }
    @keyframes slideDown {
      from { opacity:0; transform:translateY(-20px); }
      to { opacity:1; transform:translateY(0); }
    }
    @keyframes fadeInUp {
      from { opacity:0; transform:translateY(20px); }
      to { opacity:1; transform:translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity:0; }
      to { opacity:1; }
    }
  </style>
</section>


<section class="hero-section" style="
  background: linear-gradient(135deg, #0f0f1e 0%, #1a0033 50%, #2d0052 100%);
  padding: 80px 20px;
  text-align: center;
  color: white;
  position: relative;
  overflow: hidden;
  min-height: 500px;
  display: flex;
  align-items: center;
  justify-content: center;
">
  <!-- Animated background elements -->
  <div style="
    position: absolute;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(58, 134, 255, 0.15) 0%, transparent 70%);
    border-radius: 50%;
    top: -100px;
    left: -100px;
    animation: float 6s ease-in-out infinite;
  "></div>
  <div style="
    position: absolute;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(255, 0, 110, 0.1) 0%, transparent 70%);
    border-radius: 50%;
    bottom: -50px;
    right: -50px;
    animation: float 8s ease-in-out infinite reverse;
  "></div>

  <!-- Content -->
  <div style="position: relative; z-index: 2; max-width: 600px; animation: slideDown 0.8s ease-out;">
    <h2 style="
      font-size: 3rem;
      font-weight: 900;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #3a86ff 0%, #ff006e 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -1px;
    ">
      Manage Your AI Face Attendance System
    </h2>
    <p style="
      font-size: 1.2rem;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 40px;
      font-weight: 300;
      line-height: 1.6;
    ">
      Add new users or access your dashboard.
    </p>

    <!-- Buttons Container -->
    <div style="
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
      animation: fadeIn 1s ease-out 0.3s both;
    ">
      <!-- Add User Button -->
      <a href="{{ url_for('register') }}" style="
        display: inline-block;
        padding: 14px 32px;
        background: linear-gradient(135deg, #3a86ff 0%, #5b7cff 100%);
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1rem;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        box-shadow: 0 10px 30px rgba(58, 134, 255, 0.3);
        cursor: pointer;
      "
      onmouseover="
        this.style.transform = 'translateY(-3px)';
        this.style.boxShadow = '0 15px 40px rgba(58, 134, 255, 0.5)';
        this.style.background = 'linear-gradient(135deg, #5b7cff 0%, #3a86ff 100%)';
      "
      onmouseout="
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 10px 30px rgba(58, 134, 255, 0.3)';
        this.style.background = 'linear-gradient(135deg, #3a86ff 0%, #5b7cff 100%)';
      ">
        + Add User
      </a>

      <!-- Sign In Button -->
      <a href="{{ url_for('login') }}" style="
        display: inline-block;
        padding: 14px 32px;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1rem;
        border: 2px solid rgba(255, 0, 110, 0.6);
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        box-shadow: 0 10px 30px rgba(255, 0, 110, 0.2);
        cursor: pointer;
      "
      onmouseover="
        this.style.transform = 'translateY(-3px)';
        this.style.background = 'rgba(255, 0, 110, 0.2)';
        this.style.boxShadow = '0 15px 40px rgba(255, 0, 110, 0.4)';
        this.style.borderColor = 'rgba(255, 0, 110, 1)';
      "
      onmouseout="
        this.style.transform = 'translateY(0)';
        this.style.background = 'rgba(255, 255, 255, 0.1)';
        this.style.boxShadow = '0 10px 30px rgba(255, 0, 110, 0.2)';
        this.style.borderColor = 'rgba(255, 0, 110, 0.6)';
      ">
        Sign In
      </a>
    </div>
  </div>

  <style>
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(30px);
      }
    }
  </style>
</section>

<!-- Footer -->
<footer style="
  background: linear-gradient(135deg, #0f0f1e 0%, #1a0033 50%, #2d0052 100%);
  padding: 40px 20px;
  text-align: center;
  color: white;
  border-top: 1px solid rgba(58, 134, 255, 0.3);
  position: relative;
  overflow: hidden;
">
  <!-- Gradient accent line -->
  <div style="
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, #3a86ff, #ff006e, transparent);
  "></div>

  <p style="
    margin: 0;
    font-size: 0.95rem;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
    letter-spacing: 0.5px;
  ">
    © 2025 Face Attendance AI — All Rights Reserved
  </p>
  
  <p style="
    margin: 10px 0 0 0;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.5);
  ">
    Powered by Advanced AI Technology
  </p>
</footer>



    <script>
        // Simple reload helper
        function reloadPage() {
            location.reload();
        }

        // Preview image when user selects a file
        function previewImage() {
            const fileInput = document.getElementById('imageFile');
            const file = fileInput.files[0];
            const previewContainer = document.getElementById('imagePreviewContainer');
            const imagePreview = document.getElementById('imagePreview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                previewContainer.style.display = 'none';
            }
        }

        // Function to recognize face from uploaded image
        async function recognizeImage() {
            const fileInput = document.getElementById('imageFile');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('uploadResult');

            if (!file) {
                resultDiv.innerHTML = '<div class="alert alert-warning">Please select an image.</div>';
                return;
            }

            const formData = new FormData();
            formData.append('file', file);

            try {
                resultDiv.innerHTML = '<div class="alert alert-info">Processing...</div>';
                const response = await fetch('{{ url_for("video2") }}', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    let html = '<div class="alert alert-success"><strong>✓ Face Recognized!</strong><br>';
                    html += '<strong>Name:</strong> ' + result.data.name + '<br>';
                    html += '<strong>Roll No:</strong> ' + result.data.roll_no + '<br>';
                    html += '<strong>Reg ID:</strong> ' + result.data.reg_id + '<br>';
                    html += '<strong>Branch:</strong> ' + result.data.branch + '</div>';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.innerHTML = '<div class="alert alert-danger"><strong>✗ ' + result.message + '</strong></div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                console.error('Error:', error);
            }
        }
    </script>

    <script>
        // Attach/detach stream image sources on user action to avoid opening cameras on page load
        // Ensure the code runs after DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            console.log('stream controls script loaded');
            const startBtn = document.getElementById('startStreams');
            const stopBtn = document.getElementById('stopStreams');
            const cam1 = document.getElementById('cam1');
            const lastNameEl = document.getElementById('lastName');
            const lastRegEl = document.getElementById('lastReg');

            if (!startBtn || !stopBtn || !cam1) {
                console.warn('Stream controls or camera elements not found', {startBtn, stopBtn, cam1});
                return;
            }

            // Poll the server for last detection and update the UI. Optionally speak changes.
            let lastSeen = null;
            async function pollDetection() {
                try {
                    const res = await fetch("{{ url_for('last_detection_route') }}");
                    if (!res.ok) return;
                    const data = await res.json();
                    if (!data) return;
                    const key = (data.name || '') + '|' + (data.reg_id || '');
                    if (key !== lastSeen) {
                        lastSeen = key;
                        if (lastNameEl) lastNameEl.textContent = data.name || 'Unknown';
                        if (lastRegEl) lastRegEl.textContent = data.reg_id ? ('(' + data.reg_id + ')') : '';
                        // speak the detection briefly
                        if (data.name && data.name !== 'Unknown' && 'speechSynthesis' in window) {
                            const utter = new SpeechSynthesisUtterance(`${data.name}, ID ${data.reg_id}`);
                            window.speechSynthesis.cancel();
                            window.speechSynthesis.speak(utter);
                        }
                    }
                } catch (e) {
                    // ignore polling errors silently
                    console.debug('pollDetection error', e);
                }
            }
            setInterval(pollDetection, 1000);

            function start() {
                console.log('Start streams');
                if (cam1 && cam1.dataset && cam1.dataset.src) {
                    cam1.onerror = () => { if (lastNameEl) lastNameEl.textContent = 'Camera failed'; if (lastRegEl) lastRegEl.textContent = ''; };
                    cam1.onload = () => { /* loaded */ };
                    cam1.src = cam1.dataset.src;
                }
                startBtn.disabled = true;
                stopBtn.disabled = false;
            }

            function stop() {
                console.log('Stop streams');
                if (cam1) cam1.src = '';
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }

            // expose functions as global fallbacks for inline onclick
            window.startStreamAction = start;
            window.stopStreamAction = stop;

            // attach event listeners as well
            try {
                startBtn.addEventListener('click', start);
                stopBtn.addEventListener('click', stop);
            } catch (e) {
                console.debug('failed to attach listeners', e);
            }

            // Initial state: streams stopped
            stopBtn.disabled = true;
        });
    </script>

{% endblock %}